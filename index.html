<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/css/reset.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.css">
    <script src="https://cdn.mxpnl.com/libs/mixpanel-platform/build/mixpanel-platform.v0.latest.min.js"></script>
  </head>
  <body class="mixpanel-platform-body">
    
    <script>
    var projects = [];
    MP.api.people({}).done(function(results) {
        console.log(results.values());
        var total = results.values()['total'];
        projects.push(results.values()['results']);
        peopleQueryRecursive(total, results.values()['page'], results.values()['session_id']);
        console.log(projects);
        
        // Vars for avgs 
        var projects_w_people = 0;
        var projects_w_events = 0;
        var total_active_campaigns = 0;
        var total_event_similarity = 0;
        var total_date_props = 0;
        var total_dup_profs = 0;

        for(var page = 0; page<projects.length; page++){
          for(var project_id = 0; project< projects[page].length; project_id++){
            
            // Project uses events - tally up event data avgs - TODO:might want to change to TOTAL
            if(projects[page][project_id]['$properties']['Event Count (unique)'] > 0){
              projects_w_events++;
              total_event_similarity += projects[page][project_id]['$properties']['Avg Event Similarity'];
              total_date_props += projects[page][project_id]['$properties']['Date Prop Count'];
              
            }
            
            // Project uses people - vally up people data avgs
            if(projects[page][project_id]['$properties']['People Prof Count'] > 0){
              projects_w_people++;
              total_active_campaigns += projects[page][project_id]['$properties']['Active Campaign Count'];
              total_dup_profs += projects[page][project_id]['$properties']['Duplicate People Prof Count']
            }
          }
        }
        
    });
    
    function peopleQueryRecursive(total, page_number, session_id){
      total = total - 1000
      page_number++;
      //return;
      if(total <= 0){
        return;
      }
      else{
        MP.api.people({'page':page_number, 'session_id':session_id}).done(function(results) {
          console.log(results.values());
          projects.push(results.values()['results']);
          peopleQueryRecursive(total,results.values()['page'], session_id);
        });
      }
    }
    </script>
  </body>
</html>
